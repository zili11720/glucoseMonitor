<!DOCTYPE HTML>
<html>
  <%- include('../partials/head') %>
  <%- include('../partials/header') %>

  <!-- Main -->
  <article id="main">
    <header>
      <h2>Personal Space</h2>
      <p class="white-text">Please update your daily meals:</p>
    </header>
    <section class="wrapper style5">
      <div class="inner">
        <!-- Image URL Input Form -->
        <h3>Enter the URL of your meal picture</h3>
        
        <form id="urlForm" action="/home/upload" method="POST">
          <!-- Image URL -->
          <div class="form-group">
            <label for="imageUrl">Image URL:</label>
            <input type="url" id="imageUrl" name="imageUrl" placeholder="https://example.com/image.jpg" required>
          </div>

          <!-- Date Picker -->
          <div class="form-group">
            <label for="mealDate">Select the Meal Date:</label>
            <input type="date" id="mealDate" name="mealDate" required>
          </div>

          <!-- Button to check day type -->
          <div class="form-group">
            <button type="button" id="checkDayButton">Check Day Type</button>
          </div>

          <!-- Meal Type Dropdown -->
          <div class="form-group">
            <label for="mealType">Meal Type:</label>
            <select id="mealType" name="mealType" required>
              <option value="" disabled selected>Choose a meal type</option>
              <option value="breakfast">Breakfast</option>
              <option value="lunch">Lunch</option>
              <option value="dinner">Dinner</option>
            </select>
          </div>

          <!-- Glucose Level Input -->
          <div class="form-group">
            <label for="glucoseLevel">Glucose 2 hours after meal:</label>
            <input type="number" id="glucoseLevel" name="glucoseLevel" placeholder="Enter glucose level" required>
          </div>

          <!-- Submit Button -->
          <div class="form-group">
            <button type="submit">Analyze Image</button>
          </div>
        </form>

        <!-- Display the analyzed food tag -->
        <% if (typeof foodTag !== 'undefined') { %>
          <p>Detected food: <strong><%= foodTag %></strong></p>
        <% } %>
      </div>
    </section>
  </article>

  <%- include('../partials/footer') %>

  <!-- Script for redirecting based on selected date -->
  <script>
    document.getElementById('checkDayButton').addEventListener('click', function() {
      const selectedDate = document.getElementById('mealDate').value;
      
      if (selectedDate) {
        // Construct the URL with the selected date as a query parameter
        const url = `/home/getDateType?mealDate=${selectedDate}`;
        // Redirect the user to the URL
        window.location.href = url;
      } else {
        alert('Please select a date');
      }
    });
  </script>
</body>
</html>
